[
  {
    "id": "B-001",
    "title": "EXTRACTORS key mismatch breaks incremental extraction",
    "severity": "critical",
    "category": "code-bug",
    "layer": "extraction",
    "files": ["lib/codebase_index/extractor.rb"],
    "description": "EXTRACTORS constant uses plural keys (:models, :controllers) but re_extract_unit looks up by singular type (:model, :controller). Incremental extraction silently fails to find the correct extractor for any unit.",
    "status": "resolved"
  },
  {
    "id": "B-002",
    "title": "Missing types in re_extract_unit",
    "severity": "critical",
    "category": "code-bug",
    "layer": "extraction",
    "files": ["lib/codebase_index/extractor.rb"],
    "description": "The case statement in re_extract_unit only handles :model, :controller, :service, :component. Missing: :job, :mailer, :graphql_type, :graphql_mutation, :graphql_resolver, :graphql_query, :rails_source.",
    "status": "resolved"
  },
  {
    "id": "B-003",
    "title": "API controllers silently omitted from extraction",
    "severity": "high",
    "category": "code-bug",
    "layer": "extraction",
    "files": ["lib/codebase_index/extractors/controller_extractor.rb"],
    "description": "Controller discovery uses ApplicationController.descendants, which misses controllers inheriting from ActionController::API. API-only controllers are invisible to extraction.",
    "status": "resolved"
  },
  {
    "id": "B-004",
    "title": "Config extractors default missing 4 of 8 types",
    "severity": "high",
    "category": "code-bug",
    "layer": "config",
    "files": ["lib/codebase_index.rb"],
    "description": "Default extractors config only lists :models, :controllers, :services, :components. Missing: :jobs, :mailers, :graphql, :rails_source.",
    "status": "resolved"
  },
  {
    "id": "B-005",
    "title": "Missing app/graphql/ in incremental file patterns",
    "severity": "high",
    "category": "code-bug",
    "layer": "extraction",
    "files": ["lib/tasks/codebase_index.rake"],
    "description": "Incremental rake task scans app/models/, app/controllers/, app/services/, app/components/ but not app/graphql/. GraphQL type changes are never detected.",
    "status": "resolved"
  },
  {
    "id": "B-006",
    "title": "Missing eager_load! in incremental path",
    "severity": "medium",
    "category": "code-bug",
    "layer": "extraction",
    "files": ["lib/codebase_index/extractor.rb"],
    "description": "Full extraction calls eager_load! but incremental path may skip it, meaning newly-added classes won't be found.",
    "status": "resolved"
  },
  {
    "id": "B-007",
    "title": "Token estimation underestimates Ruby code by 15-25%",
    "severity": "medium",
    "category": "code-bug",
    "layer": "extraction",
    "files": ["lib/codebase_index/extracted_unit.rb"],
    "description": "The (length / 4.0).ceil heuristic underestimates tokens for Ruby code. Ruby syntax (symbols, do/end, underscored_names) produces more tokens per character than natural language.",
    "status": "resolved"
  },
  {
    "id": "B-008",
    "title": "ViewComponent metadata uses Phlex-specific patterns",
    "severity": "medium",
    "category": "code-bug",
    "layer": "extraction",
    "files": ["lib/codebase_index/extractors/phlex_extractor.rb"],
    "description": "Phlex extractor metadata structure is Phlex-specific. A future ViewComponent extractor needs different metadata patterns.",
    "status": "resolved"
  },
  {
    "id": "B-009",
    "title": "Score fusion in hybrid search is ad-hoc, needs RRF",
    "severity": "medium",
    "category": "design-gap",
    "layer": "retrieval",
    "files": ["docs/RETRIEVAL_ARCHITECTURE.md"],
    "description": "merge_candidates uses ad-hoc weighted score fusion. Should use Reciprocal Rank Fusion (RRF): score(d) = sum(1/(k + rank_i(d))) where k=60.",
    "status": "resolved"
  },
  {
    "id": "B-010",
    "title": "SQL injection pattern in Pgvector adapter pseudocode",
    "severity": "medium",
    "category": "code-bug",
    "layer": "retrieval",
    "files": ["docs/RETRIEVAL_ARCHITECTURE.md"],
    "description": "Pgvector build_where interpolates filter values directly into SQL. Should use parameterized queries.",
    "status": "resolved"
  },
  {
    "id": "B-011",
    "title": "No cross-encoder reranking stage in retrieval pipeline",
    "severity": "low",
    "category": "design-gap",
    "layer": "retrieval",
    "files": ["docs/RETRIEVAL_ARCHITECTURE.md"],
    "description": "Pipeline goes from initial ranking to context assembly with no reranking. Cross-encoder reranking would improve precision for code search.",
    "status": "resolved"
  },
  {
    "id": "B-012",
    "title": "Missing chunking for scopes and per-concern source",
    "severity": "low",
    "category": "design-gap",
    "layer": "extraction",
    "files": ["docs/CONTEXT_AND_CHUNKING.md"],
    "description": "Scopes and per-concern chunks are specified in chunking strategy but not yet implemented in extraction.",
    "status": "resolved"
  },
  {
    "id": "B-013",
    "title": "Embedding pipeline has no resumability",
    "severity": "low",
    "category": "design-gap",
    "layer": "embedding",
    "files": ["docs/OPERATIONS.md"],
    "description": "No checkpoint mechanism for embedding pipeline. Mid-batch failures require starting over.",
    "status": "resolved"
  },
  {
    "id": "B-014",
    "title": "No agent-as-operator design (extraction management, pipeline diagnostics)",
    "severity": "high",
    "category": "doc-missing",
    "layer": "agentic",
    "files": ["docs/AGENTIC_STRATEGY.md"],
    "description": "No design for agents running extraction, managing the embedding pipeline, or diagnosing failures. Agents can only consume, not operate.",
    "status": "resolved"
  },
  {
    "id": "B-015",
    "title": "No multi-agent coordination design",
    "severity": "high",
    "category": "doc-missing",
    "layer": "agentic",
    "files": ["docs/AGENTIC_STRATEGY.md"],
    "description": "No design for multiple agents working with the same index concurrently. Missing: shared state model, locking, handoff patterns, token budget coordination.",
    "status": "resolved"
  },
  {
    "id": "B-016",
    "title": "No agent self-service and diagnostics design",
    "severity": "high",
    "category": "doc-missing",
    "layer": "agentic",
    "files": ["docs/AGENTIC_STRATEGY.md"],
    "description": "No design for agents assessing retrieval quality, reporting gaps, or requesting improvements.",
    "status": "resolved"
  },
  {
    "id": "B-017",
    "title": "Concurrent indexing safety not documented",
    "severity": "medium",
    "category": "doc-missing",
    "layer": "docs",
    "files": ["docs/OPERATIONS.md"],
    "description": "No documentation of which operations are safe for concurrent access and which require serialization.",
    "status": "resolved"
  },
  {
    "id": "B-018",
    "title": "Transitive invalidation not bridged between extraction and embedding",
    "severity": "medium",
    "category": "doc-missing",
    "layer": "docs",
    "files": ["docs/OPERATIONS.md"],
    "description": "When extraction produces new units, the embedding layer needs notification. No design for this bridge.",
    "status": "resolved"
  },
  {
    "id": "B-019",
    "title": "Agent-driven operations not documented",
    "severity": "medium",
    "category": "doc-missing",
    "layer": "docs",
    "files": ["docs/OPERATIONS.md"],
    "description": "No design for how agents trigger and monitor pipeline tasks (extraction, embedding, validation).",
    "status": "resolved"
  },
  {
    "id": "B-020",
    "title": "Fix token estimation inconsistency across docs",
    "severity": "low",
    "category": "doc-fix",
    "layer": "docs",
    "files": ["docs/RETRIEVAL_ARCHITECTURE.md", "docs/MODEL_EXTRACTION_FIXES.md"],
    "description": "Code uses / 3.5 (CLAUDE.md). RETRIEVAL_ARCHITECTURE.md pseudocode uses / 4.0 in TokenCounter class. MODEL_EXTRACTION_FIXES.md says / 4. Should all reference 3.5.",
    "status": "resolved"
  },
  {
    "id": "B-021",
    "title": "Resolve remaining cross-doc contradictions from REVIEW_FINDINGS.md",
    "severity": "low",
    "category": "doc-fix",
    "layer": "docs",
    "files": ["docs/RETRIEVAL_ARCHITECTURE.md", "docs/PROPOSAL.md", "docs/REVIEW_FINDINGS.md"],
    "description": "REVIEW_FINDINGS.md CC-001 through CC-011 identified contradictions. Many resolved, some remain (tool count mismatch PROPOSAL vs AGENTIC_STRATEGY, default vector store, default embedding provider). Systematic pass needed.",
    "status": "resolved"
  },
  {
    "id": "B-022",
    "title": "Update stale plan doc status line",
    "severity": "low",
    "category": "doc-fix",
    "layer": "docs",
    "files": ["docs/plans/2026-02-13-ruby-analyzer-design.md"],
    "description": "Says 'Status: Design approved, ready for implementation planning' but AST/RubyAnalyzer/Flow are all complete. Update to reflect implemented state.",
    "status": "resolved"
  },
  {
    "id": "B-023",
    "title": "Add gem-level specs for service_extractor",
    "severity": "medium",
    "category": "test-gap",
    "layer": "extraction",
    "files": ["spec/extractors/service_extractor_spec.rb"],
    "description": "ServiceExtractor has no gem-level unit specs. Needs tests for: happy path extraction, edge cases (empty files, namespaced classes), dependency detection.",
    "status": "resolved"
  },
  {
    "id": "B-024",
    "title": "Add gem-level specs for job_extractor",
    "severity": "medium",
    "category": "test-gap",
    "layer": "extraction",
    "files": ["spec/extractors/job_extractor_spec.rb"],
    "description": "JobExtractor has no gem-level unit specs. Needs tests for: happy path extraction, edge cases (empty files, namespaced classes), dependency detection.",
    "status": "resolved"
  },
  {
    "id": "B-025",
    "title": "Add gem-level specs for mailer_extractor",
    "severity": "medium",
    "category": "test-gap",
    "layer": "extraction",
    "files": ["spec/extractors/mailer_extractor_spec.rb"],
    "description": "MailerExtractor has no gem-level unit specs. Needs tests for: happy path extraction, edge cases (empty files, namespaced classes), dependency detection.",
    "status": "resolved"
  },
  {
    "id": "B-026",
    "title": "Add gem-level specs for graphql_extractor",
    "severity": "medium",
    "category": "test-gap",
    "layer": "extraction",
    "files": ["spec/extractors/graphql_extractor_spec.rb"],
    "description": "GraphqlExtractor has no gem-level unit specs. Needs tests for: happy path extraction, edge cases (empty files, namespaced classes), dependency detection.",
    "status": "resolved"
  },
  {
    "id": "B-027",
    "title": "Add gem-level specs for rails_source_extractor",
    "severity": "medium",
    "category": "test-gap",
    "layer": "extraction",
    "files": ["spec/extractors/rails_source_extractor_spec.rb"],
    "description": "RailsSourceExtractor has no gem-level unit specs. Needs tests for: happy path extraction, importance rating, public API detection.",
    "status": "resolved"
  },
  {
    "id": "B-028",
    "title": "Implement VectorStore interface and in-memory adapter",
    "severity": "high",
    "category": "implementation",
    "layer": "storage",
    "files": ["lib/codebase_index/storage/vector_store.rb"],
    "description": "Define interface: #store, #search, #delete, #count. In-memory adapter uses hash + cosine similarity. Zero-dependency baseline.",
    "status": "resolved"
  },
  {
    "id": "B-029",
    "title": "Implement MetadataStore interface and SQLite adapter",
    "severity": "high",
    "category": "implementation",
    "layer": "storage",
    "files": ["lib/codebase_index/storage/metadata_store.rb"],
    "description": "Unit metadata, type indexes, file paths, git data. SQLite for zero-dependency local usage.",
    "status": "resolved"
  },
  {
    "id": "B-030",
    "title": "Implement GraphStore interface wrapping DependencyGraph",
    "severity": "medium",
    "category": "implementation",
    "layer": "storage",
    "files": ["lib/codebase_index/storage/graph_store.rb"],
    "description": "Existing DependencyGraph is the in-memory implementation. Wrap behind interface for future PG/MySQL backends.",
    "status": "resolved"
  },
  {
    "id": "B-031",
    "title": "Implement EmbeddingProvider interface and Ollama adapter",
    "severity": "high",
    "category": "implementation",
    "layer": "embedding",
    "files": ["lib/codebase_index/embedding/provider.rb"],
    "description": "Interface: #embed(text), #embed_batch(texts), #dimensions. Ollama first (zero external API cost), OpenAI second.",
    "status": "resolved"
  },
  {
    "id": "B-032",
    "title": "Implement text preparation pipeline",
    "severity": "medium",
    "category": "implementation",
    "layer": "embedding",
    "files": ["lib/codebase_index/embedding/text_preparer.rb"],
    "description": "Per CONTEXT_AND_CHUNKING.md: chunk selection, prefix formatting, token limit enforcement.",
    "status": "resolved"
  },
  {
    "id": "B-033",
    "title": "Implement indexing pipeline orchestrator",
    "severity": "high",
    "category": "implementation",
    "layer": "embedding",
    "files": ["lib/codebase_index/embedding/indexer.rb"],
    "description": "Reads ExtractedUnit JSON → prepares text → embeds → stores. Full + incremental modes via content_hash. Rake tasks: codebase_index:embed, codebase_index:embed_incremental. Includes checkpoint/resumability for mid-batch failures. Depends on: B-028, B-031, B-032.",
    "status": "resolved",
    "depends_on": ["B-028", "B-031", "B-032"]
  },
  {
    "id": "B-034",
    "title": "Implement query classifier",
    "severity": "high",
    "category": "implementation",
    "layer": "retrieval",
    "files": ["lib/codebase_index/retrieval/query_classifier.rb"],
    "description": "Classify by intent (lookup, trace, explain, compare), scope (specific, bounded, broad), depth. Heuristic-based.",
    "status": "resolved"
  },
  {
    "id": "B-035",
    "title": "Implement search executor with strategy selection",
    "severity": "high",
    "category": "implementation",
    "layer": "retrieval",
    "files": ["lib/codebase_index/retrieval/search_executor.rb"],
    "description": "Maps classification → strategy (vector, keyword, graph, hybrid, direct). Executes against storage backends. Depends on: B-028, B-029, B-030, B-034.",
    "status": "resolved",
    "depends_on": ["B-028", "B-029", "B-030", "B-034"]
  },
  {
    "id": "B-036",
    "title": "Implement ranker with RRF",
    "severity": "medium",
    "category": "implementation",
    "layer": "retrieval",
    "files": ["lib/codebase_index/retrieval/ranker.rb"],
    "description": "Reciprocal Rank Fusion (k=60) for combining multi-strategy results. Incorporates recency, PageRank, type-match signals. Depends on: B-035.",
    "status": "resolved",
    "depends_on": ["B-035"]
  },
  {
    "id": "B-037",
    "title": "Implement context assembler",
    "severity": "high",
    "category": "implementation",
    "layer": "retrieval",
    "files": ["lib/codebase_index/retrieval/context_assembler.rb"],
    "description": "Token-budgeted assembly: 10% structural, 50% primary, 25% supporting, 15% framework. Source attribution. Depends on: B-036.",
    "status": "resolved",
    "depends_on": ["B-036"]
  },
  {
    "id": "B-038",
    "title": "Retriever orchestrator",
    "severity": "high",
    "category": "implementation",
    "layer": "retrieval",
    "files": ["lib/codebase_index/retriever.rb", "spec/retriever_spec.rb"],
    "description": "Top-level Retriever class wiring classify → search → rank → assemble → format pipeline. Includes RetrievalResult struct and StructuralContextBuilder for 10% structural token budget.",
    "status": "resolved"
  },
  {
    "id": "B-039",
    "title": "StructuralContextBuilder (part of Retriever)",
    "severity": "medium",
    "category": "implementation",
    "layer": "retrieval",
    "files": ["lib/codebase_index/retriever.rb"],
    "description": "Private helper in Retriever that queries metadata_store for unit counts by type, generating codebase overview for the structural context budget.",
    "status": "resolved"
  },
  {
    "id": "B-040",
    "title": "Context formatting base + ClaudeAdapter",
    "severity": "high",
    "category": "implementation",
    "layer": "formatting",
    "files": ["lib/codebase_index/formatting/base.rb", "lib/codebase_index/formatting/claude_adapter.rb"],
    "description": "Abstract Formatting::Base with #format interface and #estimate_tokens helper. ClaudeAdapter outputs XML tags (<codebase-context>, <unit>, <source>) for Claude API/MCP.",
    "status": "resolved"
  },
  {
    "id": "B-041",
    "title": "GPTAdapter + GenericAdapter + HumanAdapter",
    "severity": "medium",
    "category": "implementation",
    "layer": "formatting",
    "files": ["lib/codebase_index/formatting/gpt_adapter.rb", "lib/codebase_index/formatting/generic_adapter.rb", "lib/codebase_index/formatting/human_adapter.rb"],
    "description": "GPTAdapter (Markdown headers + fenced code), GenericAdapter (plain text with separators), HumanAdapter (box-drawing chars for terminal).",
    "status": "resolved",
    "depends_on": ["B-040"]
  },
  {
    "id": "B-042",
    "title": "Pgvector vector store adapter",
    "severity": "high",
    "category": "implementation",
    "layer": "storage",
    "files": ["lib/codebase_index/storage/pgvector.rb", "spec/storage/pgvector_spec.rb"],
    "description": "VectorStore::Pgvector for PostgreSQL teams. HNSW index, parameterized SQL, cosine distance, filter translation to WHERE clauses, ensure_schema! for auto-setup.",
    "status": "resolved"
  },
  {
    "id": "B-043",
    "title": "Qdrant vector store adapter",
    "severity": "high",
    "category": "implementation",
    "layer": "storage",
    "files": ["lib/codebase_index/storage/qdrant.rb", "spec/storage/qdrant_spec.rb"],
    "description": "VectorStore::Qdrant via HTTP REST API. Qdrant-format filter translation, collection auto-creation, no gem dependencies.",
    "status": "resolved"
  },
  {
    "id": "B-044",
    "title": "Instrumentation module",
    "severity": "medium",
    "category": "implementation",
    "layer": "observability",
    "files": ["lib/codebase_index/observability/instrumentation.rb", "spec/observability/instrumentation_spec.rb"],
    "description": "Thin wrapper around ActiveSupport::Notifications with fallback to direct yield when AS unavailable (MCP server without Rails).",
    "status": "resolved"
  },
  {
    "id": "B-045",
    "title": "StructuredLogger",
    "severity": "medium",
    "category": "implementation",
    "layer": "observability",
    "files": ["lib/codebase_index/observability/structured_logger.rb", "spec/observability/structured_logger_spec.rb"],
    "description": "JSON-line logger for pipeline operations. Supports info/warn/error/debug levels with timestamps and structured data.",
    "status": "resolved"
  },
  {
    "id": "B-046",
    "title": "HealthCheck",
    "severity": "medium",
    "category": "implementation",
    "layer": "observability",
    "files": ["lib/codebase_index/observability/health_check.rb", "spec/observability/health_check_spec.rb"],
    "description": "Reports system component status (:ok, :error, :not_configured) for vector_store, metadata_store, embedding_provider.",
    "status": "resolved"
  },
  {
    "id": "B-047",
    "title": "CircuitBreaker",
    "severity": "high",
    "category": "implementation",
    "layer": "resilience",
    "files": ["lib/codebase_index/resilience/circuit_breaker.rb", "spec/resilience/circuit_breaker_spec.rb"],
    "description": "Three-state pattern (closed → open → half_open) protecting external service calls. Configurable threshold and reset_timeout. Raises CircuitOpenError when open.",
    "status": "resolved",
    "depends_on": ["B-038"]
  },
  {
    "id": "B-048",
    "title": "RetryableProvider",
    "severity": "medium",
    "category": "implementation",
    "layer": "resilience",
    "files": ["lib/codebase_index/resilience/retryable_provider.rb", "spec/resilience/retryable_provider_spec.rb"],
    "description": "Decorator wrapping Embedding::Provider::Interface with exponential backoff and circuit breaker integration. Never retries CircuitOpenError.",
    "status": "resolved",
    "depends_on": ["B-047"]
  },
  {
    "id": "B-049",
    "title": "IndexValidator",
    "severity": "medium",
    "category": "implementation",
    "layer": "resilience",
    "files": ["lib/codebase_index/resilience/index_validator.rb", "spec/resilience/index_validator_spec.rb"],
    "description": "Validates extraction output health: _index.json existence, file references, content hash integrity, stale file detection. Returns ValidationReport.",
    "status": "resolved"
  },
  {
    "id": "B-050",
    "title": "OpenAI embedding adapter",
    "severity": "high",
    "category": "implementation",
    "layer": "embedding",
    "files": ["lib/codebase_index/embedding/openai.rb", "spec/embedding/openai_spec.rb"],
    "description": "Provider::OpenAI supporting text-embedding-3-small (1536d) and text-embedding-3-large (3072d). HTTPS with Bearer auth, batch embedding with index-preservation.",
    "status": "resolved"
  },
  {
    "id": "B-051",
    "title": "MCP codebase_retrieve tool",
    "severity": "high",
    "category": "implementation",
    "layer": "agentic",
    "files": ["lib/codebase_index/mcp/server.rb", "spec/mcp/server_spec.rb"],
    "description": "Semantic search tool added to MCP server. Accepts query + optional budget, returns formatted context + source attributions. Graceful degradation when no retriever configured.",
    "status": "resolved",
    "depends_on": ["B-038"]
  },
  {
    "id": "B-052",
    "title": "Retrieval + embedding rake tasks",
    "severity": "medium",
    "category": "implementation",
    "layer": "agentic",
    "files": ["lib/tasks/codebase_index.rake"],
    "description": "Three rake tasks: codebase_index:retrieve[query] (CLI retrieval with HumanAdapter), codebase_index:embed (full embedding pipeline), codebase_index:embed_incremental (content_hash-based).",
    "status": "resolved",
    "depends_on": ["B-038"]
  }
]
